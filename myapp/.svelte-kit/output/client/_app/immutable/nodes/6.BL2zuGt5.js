import{c as K,a as m,t as w}from"../chunks/BpdS5ozQ.js";import"../chunks/ak-IiZ70.js";import{p as Nt,l as St,d as Pt,f as q,a as It,b as y,c as a,r,s,g as t,t as F,e as Lt,m as U,h as at}from"../chunks/BkNIMPUX.js";import{s as b}from"../chunks/8GdiTE-D.js";import{i as z}from"../chunks/BO1fjogy.js";import{e as rt}from"../chunks/DCYGmzsl.js";import{s as ot}from"../chunks/H21sVsVO.js";import{s as st}from"../chunks/20z5p9mC.js";import{e as x}from"../chunks/BpZ3buzO.js";import{t as it,q as Dt,a as Jt,f as qt}from"../chunks/pl10jhQ3.js";import{i as Ft}from"../chunks/CPaK9zB5.js";import{s as zt,a as Mt}from"../chunks/Cu0EAYA7.js";import{g as lt}from"../chunks/CPiIr9-y.js";import{o as Qt,w as Rt}from"../chunks/BrBxsZ45.js";var At=w('<div class="fixed inset-0 flex items-center justify-center bg-blue-50 z-50"><div class="spinner animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full"></div></div>'),Bt=w("<p> </p>"),Gt=w('<div class="flex items-center gap-4 border-b pb-4 mb-4"><img alt="Product" class="w-20 h-20 object-cover rounded-lg"> <div class="flex-1"><h3 class="text-sm font-medium"> </h3> <p class="text-lg font-semibold text-blue-600"> </p></div> <div class="flex items-center"><button class="px-2 py-1 border rounded">-</button> <span class="px-4"> </span> <button class="px-2 py-1 border rounded">+</button></div> <button class="text-gray-500 hover:text-red-500">üóëÔ∏è</button></div> <!>',1),Ht=w("<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>"),Kt=w('<div class="flex items-center gap-4 border-b pb-4 mb-4"><img alt="Product" class="w-20 h-20 object-cover rounded-lg"> <div class="flex-1"><h3 class="text-sm font-medium"> </h3> <p class="text-lg font-semibold text-blue-600"> </p></div> <div class="flex items-center"><button class="px-2 py-1 border rounded">-</button> <span class="px-4"> </span> <button class="px-2 py-1 border rounded">+</button></div> <button class="text-gray-500 hover:text-red-500">üóëÔ∏è</button></div>'),Ut=w("<p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</p>"),Vt=w('<button class="w-full bg-green-500 text-white py-2 rounded mt-4">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠</button>'),Wt=w('<div class="flex flex-col md:flex-row gap-6 p-6"><div class="flex-1 bg-white p-6 rounded-lg shadow"><h2 class="text-lg font-semibold mb-4">‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2> <div class="mb-4"><button> </button> <button> </button></div> <!></div> <div class="w-full md:w-1/3 bg-white p-6 rounded-lg shadow self-start"><h2 class="text-lg font-semibold mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h2> <div class="flex justify-between mb-2"><span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</span> <span> </span></div> <div class="flex justify-between font-bold text-lg"><span>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span> <span> </span></div> <!> <button class="w-full border mt-2 py-2 rounded text-white  bg-blue-500">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡πà‡∏≠</button></div></div>');function pe(nt,ct){Nt(ct,!1);const[dt,pt]=zt(),ft=()=>Mt(V,"$isLoading",dt),h=U();let M=null;const V=Rt(!0);let i=U([]),_=U("official");async function L(o,n){let l;const e=t(i).findIndex(p=>p.item_id&&p.item_id===t(h)[o].item_id||p.seller_item_id&&p.seller_item_id===t(h)[o].seller_item_id);console.log(n),n==-1?(t(i)[e].type==="official"?l=`http://localhost:3000/shop/publisher/cart/adjust/${t(i)[e].item_id}?reduce=true`:l=`http://localhost:3000/shop/seller/cart/adjust/${t(i)[e].seller_item_id}?reduce=true`,at(i,t(i)[e].amount-=1)):(t(i)[e].type==="official"?l=`http://localhost:3000/shop/publisher/cart/adjust/${t(i)[e].item_id}?increase=true`:l=`http://localhost:3000/shop/seller/cart/adjust/${t(i)[e].seller_item_id}?increase=true`,at(i,t(i)[e].amount+=1)),await fetch(l,{method:"get",headers:{"Content-Type":"application/json"}})}function vt(){return t(h).reduce((n,l)=>n+l.book_price*l.amount,0).toFixed(2)}async function W(o){const n=t(i).findIndex(e=>e.item_id&&e.item_id===t(h)[o].item_id||e.seller_item_id&&e.seller_item_id===t(h)[o].seller_item_id),l=t(i)[n];if(l.type==="official")try{const e=await fetch("http://localhost:3000/shop/publisher/cart/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({item_id:l.item_id})});if(!e.ok)if(e.status===400){const g=await e.json();alert(g.error)}else throw new Error(`Network response was not ok: ${e.status}`);const p=await e.json();y(i,t(i).filter((g,v)=>v!==n))}catch{alert("Failed to remove item from cart. Please try again.")}else try{const e=await fetch("http://localhost:3000/shop/seller/cart/delete",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({seller_item_id:l.seller_item_id})});if(!e.ok)if(e.status===400){const g=await e.json();alert(g.error)}else throw new Error(`Network response was not ok: ${e.status}`);const p=await e.json();y(i,t(i).filter((g,v)=>v!==n))}catch{alert("Failed to remove item from cart. Please try again.")}}async function ut(){try{const o=await fetch("http://localhost:3000/shop/publisher/cart/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:M})});if(!o.ok)throw new Error(`Network response was not ok: ${o.status}`);const n=await o.json(),l=await fetch("http://localhost:3000/shop/seller/cart/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:M})});if(!l.ok)throw new Error(`Network response was not ok: ${o.status}`);const e=await l.json();let p=n.cart_info?n.cart_info.map(v=>({...v,type:"official"})):[],g=e.cart_info?e.cart_info.map(v=>({...v,type:"seller"})):[];y(i,[...p,...g]),p.length<g.length?y(_,"seller"):y(_,"official"),V.set(!1)}catch(o){console.error("Skibidi Error",o)}}Qt(async()=>{M=localStorage.getItem("userToken"),await ut()}),St(()=>(t(i),t(_)),()=>{y(h,t(i).filter(o=>t(_)==="all"?!0:t(_)==="official"?o.type==="official":o.type==="seller"))}),Pt(),Ft();var X=K(),_t=q(X);{var mt=o=>{var n=At(),l=a(n);r(n),it(3,l,()=>Jt,()=>({duration:300,easing:Dt})),it(3,n,()=>qt,()=>({duration:300})),m(o,n)},bt=o=>{var n=Wt(),l=a(n),e=s(a(l),2),p=a(e),g=a(p);r(p);var v=s(p,2),ht=a(v);r(v),r(e);var gt=s(e,2);{var xt=c=>{var u=K(),N=q(u);rt(N,3,()=>t(h),f=>f.item_id,(f,d,k)=>{var j=Gt(),T=q(j),E=a(T),$=s(E,2),S=a($),D=a(S,!0);r(S);var J=s(S,2),P=a(J);r(J),r($);var C=s($,2),O=a(C),I=s(O,2),A=a(I,!0);r(I);var B=s(I,2);r(C);var Tt=s(C,2);r(T);var Et=s(T,2);{var Ct=G=>{var H=Bt(),Ot=a(H);r(H),F(()=>b(Ot,`${t(d).marker??""} ${t(d).cover_color??""}`)),m(G,H)};z(Et,G=>{t(d).marker&&G(Ct)})}F(()=>{ot(E,"src",t(d).book_image),b(D,t(d).book_name_th),b(P,`${t(d).book_price??""} ‡∏ö‡∏≤‡∏ó`),b(A,t(d).amount)}),x("click",O,()=>L(t(k),-1)),x("click",B,()=>L(t(k),1)),x("click",Tt,()=>W(t(k))),m(f,j)},f=>{var d=Ht();m(f,d)}),m(c,u)},yt=c=>{var u=K(),N=q(u);rt(N,3,()=>t(h),f=>f.seller_item_id,(f,d,k)=>{var j=Kt(),T=a(j),E=s(T,2),$=a(E),S=a($,!0);r($);var D=s($,2),J=a(D);r(D),r(E);var P=s(E,2),C=a(P),O=s(C,2),I=a(O,!0);r(O);var A=s(O,2);r(P);var B=s(P,2);r(j),F(()=>{ot(T,"src",t(d).book_image),b(S,t(d).book_name_th),b(J,`${t(d).book_price??""} ‡∏ö‡∏≤‡∏ó`),b(I,t(d).amount)}),x("click",C,()=>L(t(k),-1)),x("click",A,()=>L(t(k),1)),x("click",B,()=>W(t(k))),m(f,j)},f=>{var d=Ut();m(f,d)}),m(c,u)};z(gt,c=>{t(_)==="official"?c(xt):c(yt,!1)})}r(l);var Y=s(l,2),Q=s(a(Y),2),Z=s(a(Q),2),wt=a(Z);r(Z),r(Q);var R=s(Q,2),tt=s(a(R),2),kt=a(tt);r(tt),r(R);var et=s(R,2);{var $t=c=>{var u=Vt();x("click",u,()=>lt(`/checkout?type=${t(_)}`)),m(c,u)};z(et,c=>{t(h).length!=0&&c($t)})}var jt=s(et,2);r(Y),r(n),F((c,u,N,f)=>{st(p,`px-4 py-2 rounded ${(t(_)==="official"?"bg-blue-500 text-white":"bg-gray-200")??""}`),b(g,`Official : ${c??""}`),st(v,`px-4 py-2 rounded ${(t(_)==="seller"?"bg-blue-500 text-white":"bg-gray-200")??""}`),b(ht,`Official : ${u??""}`),b(wt,`${N??""} ‡πÄ‡∏•‡πà‡∏°`),b(kt,`${f??""} ‡∏ö‡∏≤‡∏ó`)},[()=>t(i).filter(c=>c.type==="official").length,()=>t(i).filter(c=>c.type==="seller").length,()=>t(h).reduce((c,u)=>c+u.amount,0),vt],Lt),x("click",p,()=>y(_,"official")),x("click",v,()=>y(_,"seller")),x("click",jt,()=>lt("/all")),m(o,n)};z(_t,o=>{ft()?o(mt):o(bt,!1)})}m(nt,X),It(),pt()}export{pe as component};
