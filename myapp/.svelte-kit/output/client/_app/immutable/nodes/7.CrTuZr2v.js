import{c as Je,a as w,t as S}from"../chunks/BpdS5ozQ.js";import"../chunks/ak-IiZ70.js";import{p as Le,f as V,a as Ae,b as l,g as e,c as t,r,s as o,t as T,n as Fe,e as ze,m as p,i as Me}from"../chunks/BkNIMPUX.js";import{s as v}from"../chunks/8GdiTE-D.js";import{i as fe}from"../chunks/BO1fjogy.js";import{e as ue,i as ve}from"../chunks/DCYGmzsl.js";import{r as k,s as Ue}from"../chunks/H21sVsVO.js";import{e as Be}from"../chunks/BpZ3buzO.js";import{t as ge,q as Ge,a as He,f as Ke}from"../chunks/pl10jhQ3.js";import{b as $}from"../chunks/BzbwHmVE.js";import{b as Qe}from"../chunks/CqdXf88-.js";import{p as Ve}from"../chunks/Bfc47y5P.js";import{i as We}from"../chunks/CPaK9zB5.js";import{s as Xe,a as be}from"../chunks/Cu0EAYA7.js";import{g as W}from"../chunks/CPiIr9-y.js";import{p as Ye}from"../chunks/BQ7FjgTO.js";import{o as Ze,w as et}from"../chunks/BrBxsZ45.js";var tt=S('<div class="fixed inset-0 flex items-center justify-center bg-blue-50 z-50"><div class="spinner animate-spin w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full"></div></div>'),rt=S("<p> </p>"),ot=S('<div class="flex items-center gap-4 border-b pb-4 mb-4"><img alt="Product" class="w-20 h-20 object-cover rounded-lg"> <div class="flex-1"><h3 class="text-sm font-medium"> </h3> <p class="text-lg font-semibold text-blue-600"> </p></div> <div class="flex items-center"><span class="px-4"> </span></div></div> <!>',1),at=S("<option> </option>"),st=S('<div class="flex flex-col md:flex-row gap-6 p-6"><div class="flex-1 bg-white p-6 rounded-lg shadow"><h2 class="text-lg font-semibold mb-4">ตะกร้าสินค้า</h2> <!></div> <div class="w-full md:w-1/3 bg-white p-6 rounded-lg shadow self-start"><h2 class="text-lg font-semibold mb-4">สรุปการสั่งซื้อ</h2> <div class="flex justify-between mb-2"><span>จำนวนหนังสือ</span> <span> </span></div> <div class="flex justify-between font-bold text-lg"><span>ยอดสุทธิ</span> <span> </span></div></div></div> <div class="container mx-auto p-4"><h1 class="text-2xl font-bold mb-4">ข้อมูลการจัดส่ง</h1> <form class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="firstName" class="block text-sm font-medium text-gray-700">ชื่อ - นามสกุล</label> <input type="text" id="firstName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div><label for="email" class="block text-sm font-medium text-gray-700">อีเมล</label> <input type="email" id="email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div><label for="phone" class="block text-sm font-medium text-gray-700">เบอร์โทรศัพท์</label> <input type="tel" id="phone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div class="md:col-span-2"><label for="address" class="block text-sm font-medium text-gray-700">ที่อยู่</label> <input type="text" id="address" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div><label for="city" class="block text-sm font-medium text-gray-700">ตำบล/แขวง</label> <input type="text" id="city" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div><label for="province" class="block text-sm font-medium text-gray-700">จังหวัด</label> <select id="province" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required><option disabled selected>เลือกจังหวัด</option><!></select></div> <div><label for="postalCode" class="block text-sm font-medium text-gray-700">รหัสไปรษณีย์</label> <input type="text" id="postalCode" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm" required></div> <div class="md:col-span-2"><button type="submit" class="w-full bg-indigo-600 border border-transparent rounded-md py-2 px-4 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">สั่งซื้อสินค้า</button></div></form></div>',1);function kt(_e,he){Le(he,!1);const[X,xe]=Xe(),D=()=>be(Ye,"$page",X),ye=()=>be(Y,"$isLoading",X);let E="",g=p([]),j=p(""),b=p(""),_=p(""),C=p(""),q=p(""),h=p(""),x=p(""),Y=et(!0);const we=["กรุงเทพมหานคร","กระบี่","กาญจนบุรี","กาฬสินธุ์","กำแพงเพชร","ขอนแก่น","จันทบุรี","ฉะเชิงเทรา","ชลบุรี","ชัยนาท","ชัยภูมิ","ชุมพร","เชียงราย","เชียงใหม่","ตรัง","ตราด","ตาก","นครนายก","นครปฐม","นครพนม","นครราชสีมา","นครศรีธรรมราช","นครสวรรค์","นนทบุรี","นราธิวาส","น่าน","บึงกาฬ","บุรีรัมย์","ปทุมธานี","ประจวบคีรีขันธ์","ปราจีนบุรี","ปัตตานี","พระนครศรีอยุธยา","พะเยา","พังงา","พัทลุง","พิจิตร","พิษณุโลก","เพชรบุรี","เพชรบูรณ์","แพร่","ภูเก็ต","มหาสารคาม","มุกดาหาร","แม่ฮ่องสอน","ยโสธร","ยะลา","ร้อยเอ็ด","ระนอง","ระยอง","ราชบุรี","ลพบุรี","ลำปาง","ลำพูน","เลย","ศรีสะเกษ","สกลนคร","สงขลา","สตูล","สมุทรปราการ","สมุทรสงคราม","สมุทรสาคร","สระแก้ว","สระบุรี","สิงห์บุรี","สุโขทัย","สุพรรณบุรี","สุราษฎร์ธานี","สุรินทร์","หนองคาย","หนองบัวลำภู","อ่างทอง","อำนาจเจริญ","อุดรธานี","อุตรดิตถ์","อุทัยธานี","อุบลราชธานี"];async function ke(){if(!e(j)||!e(b)||!e(_)||!e(C)||!e(q)||!e(h)||!e(x)){alert("กรุณากรอกข้อมูลให้ครบถ้วน");return}if(!e(b).includes("@")){alert("อีเมลไม่ถูกต้อง");return}if(!/^[0-9]{9,10}$/.test(e(_))){alert("เบอร์โทรศัพท์ไม่ถูกต้อง ความยาว 9-10 ตัวอักษร");return}if(!/^[0-9]{5}$/.test(e(x))){alert("รหัสไปรษณีย์ไม่ถูกต้อง ความยาว 5 ตัวอักษร");return}const d=e(C)+" "+e(q)+" "+e(h)+" "+e(x);try{let c;D().url.searchParams.get("type")==="official"?c="http://localhost:3000/shop/publisher/order/create":c="http://localhost:3000/shop/seller/order/create";const N=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:E,fullname:e(j),email:e(b),phone:e(_),address:d})});if(!N.ok){const O=await N.json();throw new Error(O.error||"เกิดข้อผิดพลาดในการสร้างคำสั่งซื้อ")}const f=await N.json();let u="";if(f.order_ids&&Array.isArray(f.order_ids))u=`order_ids=${f.order_ids.join(",")}`;else{console.error("Invalid order ID response:",f),alert("Failed to create order.  Invalid response from server.");return}console.log(u);const P=`/payment?${u}`;l(j,""),l(b,""),l(_,""),l(C,""),l(q,""),l(h,""),l(x,""),D().url.searchParams.get("type")==="official"?W(P):W(P+"&type=seller")}catch(c){console.error("Error creating order:",c),alert(c.message)}}function $e(){return e(g).reduce((n,d)=>n+d.book_price*d.amount,0).toFixed(2)}async function je(){if(D().url.searchParams.get("type")=="official")try{const s=await fetch("http://localhost:3000/shop/publisher/cart/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:E})});if(!s.ok)throw new Error(`Network response was not ok: ${s.status}`);const n=await s.json();l(g,n.cart_info)}catch(s){console.error("Error fetching cart count:",s)}else try{const s=await fetch("http://localhost:3000/shop/seller/cart/get",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:E})});if(!s.ok)throw new Error(`Network response was not ok: ${s.status}`);const n=await s.json();l(g,n.cart_info)}catch(s){console.error("Error fetching cart count:",s)}e(g).length==0&&W("/cart")}Ze(async()=>{E=localStorage.getItem("userToken"),await je(),Y.set(!1)}),We();var Z=Je(),Ce=V(Z);{var qe=s=>{var n=tt(),d=t(n);r(n),ge(3,d,()=>He,()=>({duration:300,easing:Ge})),ge(3,n,()=>Ke,()=>({duration:300})),w(s,n)},Ne=s=>{var n=st(),d=V(n),c=t(d),N=o(t(c),2);ue(N,1,()=>e(g),ve,(a,i)=>{var m=ot(),y=V(m),I=t(y),G=o(I,2),H=t(G),Se=t(H,!0);r(H);var ce=o(H,2),Ee=t(ce);r(ce),r(G);var me=o(G,2),pe=t(me),Ie=t(pe,!0);r(pe),r(me),r(y);var De=o(y,2);{var Oe=K=>{var Q=rt(),Re=t(Q);r(Q),T(()=>v(Re,`Name:${e(i).marker??""} Cover Color:${e(i).cover_color??""}`)),w(K,Q)};fe(De,K=>{e(i).marker&&K(Oe)})}T(()=>{Ue(I,"src",e(i).book_image),v(Se,e(i).book_name_th),v(Ee,`${e(i).book_price??""} บาท`),v(Ie,e(i).amount)}),w(a,m)}),r(c);var f=o(c,2),u=o(t(f),2),P=o(t(u),2),O=t(P);r(P),r(u);var ee=o(u,2),te=o(t(ee),2),Pe=t(te);r(te),r(ee),r(f),r(d);var re=o(d,2),R=o(t(re),2),J=t(R),oe=o(t(J),2);k(oe),r(J);var L=o(J,2),ae=o(t(L),2);k(ae),r(L);var A=o(L,2),se=o(t(A),2);k(se),r(A);var F=o(A,2),ie=o(t(F),2);k(ie),r(F);var z=o(F,2),le=o(t(z),2);k(le),r(z);var M=o(z,2),U=o(t(M),2);T(()=>{e(h),Me(()=>{})});var B=t(U);B.value=((B.__value="")==null,"");var Te=o(B);ue(Te,1,()=>we,ve,(a,i)=>{var m=at(),y={},I=t(m,!0);r(m),T(()=>{y!==(y=e(i))&&(m.value=(m.__value=e(i))==null?"":e(i)),v(I,e(i))}),w(a,m)}),r(U),r(M);var ne=o(M,2),de=o(t(ne),2);k(de),r(ne),Fe(2),r(R),r(re),T((a,i)=>{v(O,`${a??""} เล่ม`),v(Pe,`${i??""} บาท`)},[()=>e(g).reduce((a,i)=>a+i.amount,0),$e],ze),$(oe,()=>e(j),a=>l(j,a)),$(ae,()=>e(b),a=>l(b,a)),$(se,()=>e(_),a=>l(_,a)),$(ie,()=>e(C),a=>l(C,a)),$(le,()=>e(q),a=>l(q,a)),Qe(U,()=>e(h),a=>l(h,a)),$(de,()=>e(x),a=>l(x,a)),Be("submit",R,Ve(ke)),w(s,n)};fe(Ce,s=>{ye()?s(qe):s(Ne,!1)})}w(_e,Z),Ae(),xe()}export{kt as component};
